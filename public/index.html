<!DOCTYPE html>
<html lang="pt-BR" x-data x-init="$store.app.init()">

<head>
  <meta charset="UTF-8">
  <title>Helpdesk SPA</title>
  <link rel="stylesheet" href="/css/style.css">

  <!-- Scripts na ordem correta -->
  <script src="/js/main.js"></script>
  <script src="/js/login.js"></script>
  <script src="/js/dashboard.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="bg-gray-900">

  <!-- LOGIN -->
  <div x-show="$store.app.currentView === 'login'" class="login-container">
    <form id="login-form">
      <div class="container">
        <img class="login-logo" src="/assets/images/logo-banner.png" alt="Logo">
        <input type="text" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Senha">
        <button id="login-btn">Entrar</button>
        <p id="login-error" class="error"></p>
        <p>Ainda não tem conta? <a>Solicitar acesso!</a></p>
      </div>
    </form>
  </div>

  <!-- DASHBOARD admin -->
  <div x-show="$store.app.currentView === 'dashboard'" x-data="dashboard()" class="dashboard-container flex h-screen">

    <!-- SIDEBAR -->
    <div class="dashboard-sidebar bg-gray-800 p-4 flex flex-col justify-between">
      <div>
        <div id="logo-container" class=" mb-8">
          <img id="logo" src="/assets/images/logo-branco.png" alt="Logo" class="ml-2">
        </div>
        <ul>
          <template x-for="item in menus[$store.app.role]" :key="item.page">
            <li>
              <a href="#" class="menu-item" :class="{ 'bg-gray-700': currentPage === item.page }"
                @click.prevent="goTo(item.page, item.css)" x-text="item.label">
              </a>
            </li>
          </template>
        </ul>
      </div>
      <div>
        <button @click="logout()" class=" logout-btn w-full py-2 px-3 bg-red-600 rounded hover:bg-red-500">
          Logout
        </button>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div id="page-container" class="flex-1 p-6 bg-gray-900">

      <div x-show="currentPage === 'dashboard'">
        <h1 class="">Dashboard</h1>
        <p>Bem-vindo ao painel!</p>
      </div>

      <div x-show="currentPage === 'users'">
        <h1 class="">Usuários</h1>
        <p>Gerencie os usuários aqui.</p>
      </div>

      <div x-show="currentPage === 'create-ticket'">
        <h1>Abrir chamado</h1>

        <div x-data="{
            title: '',
            description: '',
            priority: 'low',
            createdBy: 1,
            assignedTo: null,
            hotelId: null,
            async submitForm() {
              if (!this.title || !this.description || !this.hotelId) {
                alert('Preencha todos os campos obrigatórios.');
                return;
              }
              await createTicket(
                this.title,
                this.description,
                this.priority,
                this.createdBy,
                this.assignedTo,
                this.hotelId
              );
              // limpa os campos depois de enviar
              this.title = '';
              this.description = '';
              this.priority = 'low';
              this.hotelId = null;
            }
          }" class="w-6xl mt-5 mx-auto bg-gray-800 p-6 rounded-2xl shadow-md text-gray-200">


          <!-- Título -->
          <div class="mb-4">
            <label class="block text-sm mb-1">Título *</label>
            <input type="text" x-model="title" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 
             focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Digite o título do chamado" />
          </div>

          <!-- Descrição -->
          <div class="mb-4">
            <label class="block text-sm mb-1">Descrição *</label>
            <textarea x-model="description" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 
             focus:ring-2 focus:ring-blue-500 focus:outline-none" rows="4"
              placeholder="Descreva o problema..."></textarea>
          </div>

          <!-- Prioridade -->
          <div class="mb-4">
            <label class="block text-sm mb-1">Prioridade *</label>
            <select x-model="priority" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 
             focus:ring-2 focus:ring-blue-500 focus:outline-none">
              <option value="low">Baixa</option>
              <option value="medium">Média</option>
              <option value="high">Alta</option>
            </select>
          </div>

          <!-- Hotel -->
          <div class="mb-4">
            <label class="block text-sm mb-1">Hotel *</label>
            <select x-model="hotelId" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 
             focus:ring-2 focus:ring-blue-500 focus:outline-none">
              <option value="" disabled selected>Selecione um hotel</option>
              <option value="1">H8273 - Ibis Canoas Shopping</option>
              <option value="2">H6665 - Novotel Porto Alegre Aeroporto</option>
              <option value="3">H3258 - Novotel Porto Alegre Três Figueiras</option>
              <option value="4">H9087 - Novotel Porto Alegre Assis Brasil</option>
              <option value="5">H5670 - Ibis Porto Alegre Assis Aeroporto</option>
            </select>
          </div>

          <!-- Botão -->
          <button @click="submitForm" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 
           rounded-lg transition-colors">
            Criar Chamado
          </button>
        </div>




      </div>

      <div x-show="currentPage === 'tickets'" x-init="getTickets()" class="flex flex-col h-screen gap-4 overflow-auto">

        <h1 class="font-bold text-white">Chamados</h1>

        <div class="flex space-x-2 border-b border-gray-700">
          <button class="tab-btn" @click="activeTab = 'aguardando'"
            :class="activeTab === 'aguardando' ? 'border-b-2 border-gray-400 text-white' : 'border-b-2 border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500'"
            class="">
            Aguardando atendimento
          </button>

          <button class="tab-btn" @click="activeTab = 'atendimento'"
            :class="activeTab === 'atendimento' ? 'border-b-2 border-gray-400 text-white' : 'border-b-2 border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500'"
            class="">
            Em atendimento
          </button>

          <button class="tab-btn" @click="activeTab = 'menu3'"
            :class="activeTab === 'menu3' ? 'border-b-2 border-gray-400 text-white' : 'border-b-2 border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500'"
            class="">
            Com resposta do solicitante
          </button>

          <button class="tab-btn" @click="activeTab = 'menu4'"
            :class="activeTab === 'menu4' ? 'border-b-2 border-gray-400 text-white' : 'border-b-2 border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500'"
            class="">
            Aguardando confirmação de encerramento
          </button>

          <button class="tab-btn" @click="activeTab = 'menu4'"
            :class="activeTab === 'menu4' ? 'border-b-2 border-gray-400 text-white' : 'border-b-2 border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500'"
            class="">
            Encerrados
          </button>
        </div>


        <!-- Lista de tickets -->
        <template x-for="ticket in ticketList" :key="ticket.id">

          <!-- Ticket -->
          <div class="menu-item p-20 bg-gray-800 rounded shadow flex justify-between items-center">
            <div>
              <p class="inline text-sm text-gray-400" x-text="ticket.id + ' |'"></p>
              <p class=" inline text-sm text-gray-400" x-text="ticket.hotel.name + ' - '"></p>
              <p class=" inline text-sm text-gray-400" x-text="ticket.hotel.code"></p>
              <h2 class="mt-1 text-white font-bold text-sm" x-text="ticket.title"></h2>
              <p class=" italic text-sm text-gray-300" x-text="ticket.description"></p>
            </div>
            <div class="text-right">
              <span class="text-red-500 font-semibold" x-show="ticket.status === 'open'" x-text="'Aberto'"></span>
              <span class="text-green-500 font-semibold" x-show="ticket.status === 'closed'" x-text="'Fechado'"></span>
            </div>
          </div>
        </template>

        <!-- Mensagem quando não há tickets -->
        <p x-show="ticketList.length === 0" class="text-gray-400">Nenhum chamado encontrado</p>

      </div>

      </template>

    </div>

  </div>

  </div>

</body>

</html>